# .github/workflows/daily_ia_run.yml
name: Tarea Diaria de IA (Generación Autónoma)

on:
  # Ejecuta el flujo de trabajo todos los días a las 03:00 AM ART (06:00 AM UTC).
  schedule:
    - cron: '0 6 * * *'
  
  # Permite ejecución manual para pruebas desde GitHub
  workflow_dispatch:

jobs:
  generate_and_deploy_content:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write 
      
    env:
      ALL_LOCALITIES: "leones marcos_juarez" 
    
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      
      - name: Instalar dependencias (google-genai, requests, pytz)
        run: pip install google-genai requests pytz

      - name: Ejecutar Robot (Generator.py) para todas las ciudades
        run: |
          echo "Iniciando ejecución programada para las localidades definidas:"
          for city_id in $ALL_LOCALITIES; do
            echo "-> Generando contenido para $city_id"
            python generator.py $city_id
          done
      
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        
      - name: Commit y Push de los archivos generados
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          
          git add noticias_*.json 
          git commit -m "Robot: Actualización Autónoma Programada" || echo "No hay cambios para commit"
          git push
