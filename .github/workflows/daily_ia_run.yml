# .github/workflows/daily-update.yml
name: Tarea Diaria de IA (Generaci贸n Aut贸noma)

on:
  # Ejecuta el flujo de trabajo todos los d铆as a las 03:00 AM ART (06:00 AM UTC).
  schedule:
    - cron: '0 6 * * *'
  
  # Tambi茅n permite ejecutarlo manualmente para pruebas desde el men煤 de GitHub Actions
  workflow_dispatch:

jobs:
  generate_and_deploy_content:
    runs-on: ubuntu-latest
    
    # Permiso esencial para que el bot pueda commitear los nuevos JSON
    permissions:
      contents: write 
      
    #  DEFINICIN DE CIUDADES PARA EL MODO AUTOMTICO
    env:
      ALL_LOCALITIES: "leones marcos_juarez" 
    
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      
      - name: Instalar dependencias (google-genai, requests, pytz)
        # Instalamos todas las dependencias necesarias para Gemini y la zona horaria
        run: pip install google-genai requests pytz

      - name: Ejecutar Robot (Generator.py) para todas las ciudades
        run: |
          echo "Iniciando ejecuci贸n programada para las localidades definidas:"
          for city_id in $ALL_LOCALITIES; do
            echo "-> Generando contenido para $city_id"
            # Ejecuta el script con el ID de la ciudad
            python generator.py $city_id
          done
      
        env:
          # Clave de Gemini inyectada de forma segura
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        
      - name: Commit y Push de los archivos generados
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          
          #  CRTICO: Agrega y commitea todos los archivos noticias_*.json
          git add noticias_*.json 
          git commit -m "Robot: Actualizaci贸n Aut贸noma Programada [Dec 10th]" || echo "No hay cambios para commit"
          git push
