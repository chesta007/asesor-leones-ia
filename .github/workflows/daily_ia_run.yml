# .github/workflows/daily_ia_run.yml
name: Tarea Diaria de IA (Generación Autónoma)

on:
  # CRÍTICO: Disparador que se ejecuta todos los días a las 03:00 AM ART
  schedule:
    - cron: '0 6 * * *'
  
  # Permite ejecución manual para pruebas desde GitHub
  workflow_dispatch:

jobs:
  generate_content:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write 
      
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4
      
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      
      # Instala las dependencias necesarias
      - name: Instalar dependencias
        run: pip install requests google-genai pytz

      - name: Ejecutar Robot (Generación para TODAS las ciudades)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        # NOTA: Ejecutamos el script sin argumentos. El script se encarga de ITERAR
        run: python generator.py 
      
      # CRÍTICO: Hace commit de AMBOS archivos JSON
      - name: Commit y Push de archivos generados
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Robot: Actualización Autónoma Diaria (Todas las ciudades)"
          files: noticias_*.json # Asegura que TODOS los archivos se suban
          skip_ci: true
